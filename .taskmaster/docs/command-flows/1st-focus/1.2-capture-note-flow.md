# /capture-note Command Flow Trace

> **Purpose**: Quick note capture to the current project's local notes folder. Notes stay local until audited and synced to the Obsidian vault.

---

## Overview

| Property | Value |
|----------|-------|
| **Command** | `/capture-note` |
| **Spawns Agent** | No (single operation, stays in main context) |
| **Complexity** | Low (single write operation) |
| **Write Operations** | Local file write (low risk) |

| Feature                  | Obsidian Read | Obsidian Write | Linear Read | Linear Write | Graphiti Read | Graphiti Write | GitHub Read | GitHub Write | Git Read |
| -------------------------- | --------------- | ---------------- | ------------- | -------------- | --------------- | ---------------- | ------------- | -------------- | ---------- |
| `/capture-note`          |               | ✅             |             |              |               |                |             |              |          |

---

## Why No Agent?

This command is intentionally simple:

1. Single MCP call to write a note
2. No cross-system synthesis needed
3. No batch approval pattern required (local files only)
4. Fast execution preferred over comprehensive analysis

Agent spawning adds latency and context overhead that isn't justified for a quick capture.

---

## Flow Diagram

```
User: /capture-note
         │
         ▼
┌─────────────────────────────────────────┐
│  COMMAND: capture-note.md               │
│                                         │
│  1. Load skill: project-context         │
│  2. Load skill: obsidian-writer         │
│  3. Detect current project              │
│  4. Handle directly (no agent)          │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 1: Detect Project Context        │
│                                         │
│  Tool: Bash(pwd:*)                      │
│  → Get current directory                │
│                                         │
│  Tool: Bash(basename:*)                 │
│  → Extract project name                 │
│                                         │
│  OR                                     │
│                                         │
│  Tool: Read                             │
│  Path: ./CLAUDE.md                      │
│  → Parse project reference              │
│                                         │
│  Result: project_name = "pe-evaluation" │
│          notes_dir = "./notes/"         │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 2: Prompt for Note Content       │
│                                         │
│  Display to user:                       │
│                                         │
│  "Capturing note for: PE Evaluation"    │
│                                         │
│  "Enter note title:"                    │
│  > [user enters title]                  │
│                                         │
│  "Enter note content (or 'dictate' for  │
│  voice, 'done' when finished):"         │
│  > [user enters content]                │
│  > [multi-line supported]               │
│  > done                                 │
│                                         │
│  OR if content provided inline:         │
│  /capture-note "Auth decision: JWT"     │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 3: Generate Note Structure       │
│                                         │
│  Generate filename from title:          │
│  - "Auth decision: JWT"                 │
│  - → "auth-decision-jwt.md"             │
│                                         │
│  Generate frontmatter:                  │
│  ```yaml                                │
│  ---                                    │
│  title: Auth decision: JWT              │
│  created: 2025-12-04T10:30:00           │
│  project: pe-evaluation                 │
│  status: draft                          │
│  tags:                                  │
│    - captured                           │
│    - needs-audit                        │
│  ---                                    │
│  ```                                    │
│                                         │
│  Full note content:                     │
│  ```markdown                            │
│  ---                                    │
│  [frontmatter]                          │
│  ---                                    │
│                                         │
│  # Auth decision: JWT                   │
│                                         │
│  [user content]                         │
│                                         │
│  ---                                    │
│  *Captured via /capture-note*           │
│  ```                                    │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 4: Write Note to Local           │
│                                         │
│  Ensure notes directory exists:         │
│  Tool: Bash(mkdir:*)                    │
│  Params: -p ./notes                     │
│                                         │
│  Write note file:                       │
│  Tool: Write                            │
│  Path: ./notes/auth-decision-jwt.md     │
│  Content: [generated note]              │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  OUTPUT: Capture Confirmation           │
│                                         │
│  ✅ Note captured: auth-decision-jwt.md │
│                                         │
│  Location: ./notes/auth-decision-jwt.md │
│  Project: PE Evaluation                 │
│  Status: draft (needs audit)            │
│                                         │
│  Next steps:                            │
│  - Edit note: open ./notes/auth-...     │
│  - Audit notes: /audit-notes            │
│  - Sync to vault: via /audit-notes      │
└─────────────────────────────────────────┘
```

---

## Tool Calls Summary

### Read Operations (Auto-Allowed)

| Tool | Purpose | Parameters |
|------|---------|------------|
| `Bash(pwd:*)` | Current directory | - |
| `Bash(basename:*)` | Project name | - |
| `Read` | CLAUDE.md for context | `{file_path: "./CLAUDE.md"}` |

### Write Operations (Auto-Allowed - Local Only)

| Tool | Purpose | Approval |
|------|---------|----------|
| `Bash(mkdir:*)` | Ensure notes dir | Auto (local) |
| `Write` | Create note file | Auto (local) |

---

## Skills Required

| Skill | Why Needed |
|-------|------------|
| `project-context` | Detect current project |
| `obsidian-writer` | Knowledge of note structure patterns |

---

## Note Lifecycle

```
┌─────────────────┐
│  /capture-note  │
│  (this command) │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  ./notes/       │  ← Local project folder
│  [draft notes]  │    Not in Obsidian vault
└────────┬────────┘
         │
         │ /audit-notes
         ▼
┌─────────────────┐
│  Audit Process  │
│  - Atomic check │
│  - Dedup check  │
│  - Placement    │
└────────┬────────┘
         │
         │ Batch approval
         ▼
┌─────────────────┐
│  Obsidian Vault │  ← Final destination
│  [synced notes] │    With tags, links
└─────────────────┘
```

---

## Inline vs Interactive Mode

### Inline Mode (Quick)
```bash
/capture-note "Auth decision: Use JWT for stateless auth"
```
- Title derived from first sentence
- Content is the full argument
- No prompts, immediate capture

### Interactive Mode (Detailed)
```bash
/capture-note

# Prompts:
> Title: Auth decision
> Content:
> We decided to use JWT for authentication because...
> This allows stateless scaling and simplifies...
> done

✅ Note captured
```

---

## Error Handling

| Scenario | Handling |
|----------|----------|
| Not in project directory | Prompt for project or use default |
| Notes dir doesn't exist | Create it |
| File already exists | Append timestamp to filename |
| Empty content | Prompt user to enter content |
| CLAUDE.md not found | Use directory name as project |

---

## Example Usage

### Quick Capture
```
User: /capture-note "Decided to use PostgreSQL for better relational queries"