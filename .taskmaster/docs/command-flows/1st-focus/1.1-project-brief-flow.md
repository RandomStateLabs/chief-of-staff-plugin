# /project-brief [name] Command Flow Trace

> **Purpose**: Deep dive into a specific project. Synthesizes all context from Graphiti memory (primary historical source), TaskMaster docs (PRD + captured notes), Linear issues, GitHub remote state, and a lightweight Obsidian scan to provide a comprehensive project status report.

---

## Overview


| Property             | Value                                       |
| ---------------------- | --------------------------------------------- |
| **Command**          | `/project-brief [name]`                     |
| **Spawns Agent**     | Yes -`project-analyst`                      |
| **Complexity**       | High (multi-system synthesis, 200K context) |
| **Write Operations** | None (read-only analysis)                   |

| Feature                  | Graphiti Read | TaskMaster Docs | Obsidian Read | Linear Read | GitHub Read | Git Read |
| -------------------------- | --------------- | ----------------- | --------------- | ------------- | ------------- | ---------- |
| `/project-brief [name]`  | ✅ (primary)  | ✅ (full)       | ✅ (light)    | ✅          | ✅          | ✅       |

---

## Flow Diagram

```
User: /project-brief "PE Evaluation"
         │
         ▼
┌─────────────────────────────────────────┐
│  COMMAND: project-brief.md              │
│                                         │
│  1. Parse argument: project name        │
│  2. Load skill: project-context         │
│  3. Validate project exists             │
│  4. Spawn agent: project-analyst        │
│     with project name in prompt         │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  AGENT: project-analyst                 │
│  (200K context)                         │
│                                         │
│  Prompt includes: "Analyze project:     │
│  PE Evaluation"                         │
│                                         │
│  Activated Skills (in priority order):  │
│  - project-context                      │
│  - graphiti-memory (read only)          │
│  - taskmaster-docs                      │
│  - obsidian-reader (lightweight)        │
│  - linear-integration (read only)       │
│  - github-integration (read only)       │
│  - git-operations (read only)           │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 1: Resolve Project Identity      │
│                                         │
│  Tool: mcp__linear__list_projects       │
│  → Find Linear project by name          │
│                                         │
│  Tool: mcp__linear__get_project         │
│  Params: {query: "PE Evaluation"}       │
│  → Get project details, description     │
│                                         │
│  Determine:                             │
│  - Linear project ID                    │
│  - GitHub repo (from Linear desc)       │
│  - Graphiti group_id: "work:pe-eval"    │
│  - Local directory (if detectable)      │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 2: Gather Graphiti Context       │
│  (Primary historical source)            │
│                                         │
│  Tool: mcp__graphiti__search_memory_facts
│  Params: {                              │
│    query: "PE Evaluation decisions",    │
│    group_ids: ["work:pe-eval"],         │
│    max_facts: 20                        │
│  }                                      │
│  → Already-distilled facts & decisions  │
│                                         │
│  Tool: mcp__graphiti__search_nodes      │
│  Params: {                              │
│    query: "PE Evaluation",              │
│    group_ids: ["work:pe-eval"],         │
│    max_nodes: 15                        │
│  }                                      │
│  → Key entities and relationships       │
│                                         │
│  Tool: mcp__graphiti__get_episodes      │
│  Params: {                              │
│    group_ids: ["work:pe-eval"],         │
│    max_episodes: 10                     │
│  }                                      │
│  → Recent memory episodes               │
│                                         │
│  This tells us "what do we already know"│
│  without reading full notes             │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 3: Gather TaskMaster Docs        │
│  (PRD, architecture, captured notes)    │
│                                         │
│  Tool: Glob                             │
│  Pattern: ./.taskmaster/docs/**/*.md    │
│  → Find all docs: PRD, architecture,    │
│    command flows, AND captured notes    │
│                                         │
│  Tool: Read                             │
│  Path: ./.taskmaster/docs/prd.md        │
│  → Project requirements                 │
│                                         │
│  Tool: Read (if exists)                 │
│  Path: ./CLAUDE.md                      │
│  → Project context and conventions      │
│                                         │
│  This folder contains BOTH:             │
│  - Stable reference materials (PRD)     │
│  - Fresh captures since last sync       │
│    (may contain info NOT yet in         │
│    Graphiti)                            │
│                                         │
│  Extract:                               │
│  - Decisions made                       │
│  - Blockers mentioned                   │
│  - Progress updates                     │
│  - Open questions                       │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 4: Gather Obsidian Context       │
│  (Lightweight scan - safety net)        │
│                                         │
│  Tool: obsidian_get_recent_changes      │
│  Params: {days: 7, limit: 5}            │
│  → Recent notes (may not be in Graphiti)│
│                                         │
│  OR targeted search with low limit:     │
│  Tool: obsidian_simple_search           │
│  Params: {                              │
│    query: "PE Evaluation",              │
│    context_length: 100                  │
│  }                                      │
│  → Just snippets, read top 3-5 only     │
│                                         │
│  This is a SUPPLEMENT to Graphiti,      │
│  not the primary source. Catches:       │
│  - Notes added but not yet processed    │
│  - Recent journal entries               │
│  - Tagged content not fact-extracted    │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 5: Gather Linear Context         │
│                                         │
│  Tool: mcp__linear__list_issues         │
│  Params: {                              │
│    project: "PE Evaluation",            │
│    includeArchived: false               │
│  }                                      │
│  → Get all project issues               │
│                                         │
│  Tool: mcp__linear__list_cycles         │
│  Params: {teamId: "...", type: "current"}
│  → Get current sprint/cycle             │
│                                         │
│  Categorize issues by:                  │
│  - Status (done, in-progress, pending)  │
│  - Priority (urgent, high, normal, low) │
│  - Assignee                             │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 6: Gather GitHub Remote Context  │
│                                         │
│  Tool: mcp__MCP_DOCKER__search_repositories
│  Params: {query: "pe-eval owner:..."}   │
│  → Find repository                      │
│                                         │
│  Tool: mcp__MCP_DOCKER__list_pull_requests
│  Params: {                              │
│    owner: "...",                        │
│    repo: "pe-eval",                     │
│    state: "all"                         │
│  }                                      │
│  → All PRs (open, closed, merged)       │
│                                         │
│  Tool: mcp__MCP_DOCKER__list_commits    │
│  Params: {                              │
│    owner: "...",                        │
│    repo: "pe-eval",                     │
│    perPage: 20                          │
│  }                                      │
│  → Recent commit history                │
│                                         │
│  For open PRs:                          │
│  Tool: mcp__MCP_DOCKER__get_pull_request_status
│  → CI/CD status                         │
│                                         │
│  Tool: mcp__MCP_DOCKER__list_issues     │
│  Params: {owner: "...", repo: "..."}    │
│  → GitHub issues (if used)              │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 7: Gather Local Git Context      │
│  (if local directory detected)          │
│                                         │
│  Tool: Bash(git status:*)               │
│  → Uncommitted changes                  │
│                                         │
│  Tool: Bash(git log:*)                  │
│  Params: --oneline -20                  │
│  → Local commit history                 │
│                                         │
│  Tool: Bash(git diff:*)                 │
│  Params: --stat                         │
│  → Pending changes                      │
│                                         │
│  Tool: Bash(git branch -a:*)            │
│  → All branches (local + remote)        │
│                                         │
│  Tool: Bash(git remote -v:*)            │
│  → Remote configuration                 │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  PHASE 8: Synthesis & Analysis          │
│                                         │
│  Cross-reference all sources:           │
│                                         │
│  1. Task Completion Rate                │
│     - Linear done vs total              │
│     - Velocity trend from Graphiti      │
│                                         │
│  2. Blockers Analysis                   │
│     - From Linear (blocked status)      │
│     - From notes (mentions of blocked)  │
│     - From Graphiti (past blockers)     │
│                                         │
│  3. Decision History                    │
│     - Key decisions from notes          │
│     - Rationale from Graphiti           │
│                                         │
│  4. Code Health                         │
│     - PR merge rate                     │
│     - CI status                         │
│     - Uncommitted work                  │
│                                         │
│  5. Knowledge Gaps                      │
│     - Open questions in notes           │
│     - Missing documentation             │
└────────────────┬────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────┐
│  OUTPUT: Project Brief                  │
│                                         │
│  ## Project Brief: PE Evaluation        │
│  Generated: December 4, 2025            │
│                                         │
│  ### Executive Summary                  │
│  [2-3 sentence overview]                │
│                                         │
│  ### Task Status                        │
│  - Done: X tasks                        │
│  - In Progress: Y tasks                 │
│  - Pending: Z tasks                     │
│  - Blocked: W tasks                     │
│                                         │
│  ### Current Blockers                   │
│  1. [blocker with context]              │
│  2. [blocker with context]              │
│                                         │
│  ### Recent Decisions                   │
│  - [decision]: [rationale]              │
│                                         │
│  ### Code Status                        │
│  - Open PRs: N                          │
│  - Recent commits: M                    │
│  - Uncommitted changes: [yes/no]        │
│                                         │
│  ### Knowledge from Memory              │
│  - [relevant facts from Graphiti]       │
│                                         │
│  ### Recommendations                    │
│  1. [actionable recommendation]         │
│  2. [actionable recommendation]         │
└─────────────────────────────────────────┘
```

---

## Tool Calls Summary

### Read Operations (All Auto-Allowed)

#### Phase 1: Project Resolution
| Tool                                          | Purpose         | Parameters                  |
| ----------------------------------------------- | ----------------- | ----------------------------- |
| `mcp__linear__list_projects`                  | Find project    | -                           |
| `mcp__linear__get_project`                    | Project details | `{query: "[name]"}`         |

#### Phase 2: Graphiti (Primary Historical Source)
| Tool                                          | Purpose                    | Parameters                  |
| ----------------------------------------------- | ---------------------------- | ----------------------------- |
| `mcp__graphiti__search_memory_facts`          | Distilled facts & decisions | `{group_ids: ["work:..."], max_facts: 20}` |
| `mcp__graphiti__search_nodes`                 | Key entities & relationships | `{group_ids: ["work:..."], max_nodes: 15}` |
| `mcp__graphiti__get_episodes`                 | Recent memory episodes       | `{group_ids: ["work:..."], max_episodes: 10}` |

#### Phase 3: TaskMaster Docs (PRD + Captured Notes)
| Tool                                          | Purpose                    | Parameters                  |
| ----------------------------------------------- | ---------------------------- | ----------------------------- |
| `Glob`                                        | Find all taskmaster docs    | `./.taskmaster/docs/**/*.md`|
| `Read`                                        | Read PRD                    | `{file_path: "./.taskmaster/docs/prd.md"}`|
| `Read`                                        | Read CLAUDE.md              | `{file_path: "./CLAUDE.md"}`|
| `Read`                                        | Read captured notes         | `{file_path: "./.taskmaster/docs/..."}` |

#### Phase 4: Obsidian (Lightweight Scan)
| Tool                                          | Purpose                    | Parameters                  |
| ----------------------------------------------- | ---------------------------- | ----------------------------- |
| `mcp__MCP_DOCKER__obsidian_get_recent_changes`| Recent vault notes          | `{days: 7, limit: 5}`       |
| `mcp__MCP_DOCKER__obsidian_simple_search`     | Targeted search (optional)  | `{query: "[name]", context_length: 100}` |
| `mcp__MCP_DOCKER__obsidian_get_file_contents` | Read top 3-5 results        | `{filepath: "..."}`         |

#### Phase 5: Linear
| Tool                                          | Purpose         | Parameters                  |
| ----------------------------------------------- | ----------------- | ----------------------------- |
| `mcp__linear__list_issues`                    | Project issues  | `{project: "[name]"}`       |
| `mcp__linear__list_cycles`                    | Current sprint  | `{type: "current"}`         |

#### Phase 6: GitHub Remote
| Tool                                          | Purpose         | Parameters                  |
| ----------------------------------------------- | ----------------- | ----------------------------- |
| `mcp__MCP_DOCKER__search_repositories`        | Find repo       | `{query: "..."}`            |
| `mcp__MCP_DOCKER__list_pull_requests`         | All PRs         | `{state: "all"}`            |
| `mcp__MCP_DOCKER__list_commits`               | Commit history  | `{perPage: 20}`             |
| `mcp__MCP_DOCKER__get_pull_request_status`    | CI status       | -                           |
| `mcp__MCP_DOCKER__list_issues`                | GitHub issues   | -                           |

#### Phase 7: Local Git
| Tool                                          | Purpose         | Parameters                  |
| ----------------------------------------------- | ----------------- | ----------------------------- |
| `Bash(git status:*)`                          | Local state     | -                           |
| `Bash(git log:*)`                             | Local history   | `--oneline -20`             |
| `Bash(git diff:*)`                            | Pending changes | `--stat`                    |
| `Bash(git branch -a:*)`                       | All branches    | -                           |
| `Bash(git remote -v:*)`                       | Remote config   | -                           |

### Write Operations

**None** - This is a read-only analysis command.

---

## Skills Required


| Skill                | Why Needed                                | Priority |
| ---------------------- | ------------------------------------------- | -------- |
| `project-context`    | Resolve project identity across systems   | 1st      |
| `graphiti-memory`    | Query project-specific facts and history (primary historical source) | 2nd |
| `taskmaster-docs`    | Read .taskmaster/docs/ (PRD + captured notes) | 3rd      |
| `obsidian-reader`    | Lightweight scan of vault (supplement to Graphiti) | 4th |
| `linear-integration` | Read project issues and status            | 5th      |
| `github-integration` | Read remote repo state (PRs, commits, CI) | 6th      |
| `git-operations`     | Check local repo state                    | 7th      |

---

## Project Resolution Logic

The agent resolves project identity through multiple methods:

1. **Exact Linear project name match**
2. **Fuzzy Linear project search**
3. **CLAUDE.md reference in local directory**
4. **Graphiti group_id pattern** (`work:[slug]`)
5. **GitHub repo name match**

Priority: Linear > CLAUDE.md > GitHub > Graphiti

---

## Error Handling

**Critical**: When a data source is missing or returns empty, the agent MUST:
1. Continue gathering from remaining sources
2. **Report the gap in the output** so the user knows what's missing

Never silently skip a source - always surface what couldn't be retrieved.

| Scenario                    | Handling                                    | Report In Output |
| ----------------------------- | --------------------------------------------- | ------------------ |
| Project not found in Linear | Use CLAUDE.md or directory name             | ⚠️ "Linear project not found - using local context only" |
| Graphiti empty              | Rely on .taskmaster/docs/ and Obsidian      | ⚠️ "No Graphiti memory found for this project" |
| No .taskmaster/docs/        | Continue without PRD/notes                  | ⚠️ "No .taskmaster/docs/ found - missing PRD context" |
| Obsidian MCP error          | Continue with other sources                 | ⚠️ "Obsidian connection failed - vault not scanned" |
| No GitHub repo              | Continue with other sources                 | ⚠️ "No GitHub repo linked to this project" |
| GitHub API error            | Continue with other sources                 | ⚠️ "GitHub API error - remote state unavailable" |
| Local directory not found   | Continue with remote data only              | ⚠️ "Not in project directory - local git state unavailable" |
| Linear API error            | This is critical - may need to abort        | ❌ "Linear API error - task status unreliable" |

### Output Section for Gaps

The synthesis output should include a **Data Gaps** section when sources are missing:

```markdown
### Data Gaps ⚠️

The following sources were unavailable for this brief:
- Graphiti: No memory found for group "work:pe-eval"
- GitHub: Repository not linked in Linear project description

This may affect the completeness of the analysis.
```

---

## Example Output

```markdown
## Project Brief: PE Evaluation

**Generated**: December 4, 2025
**Linear Project**: [PE Evaluation](linear-link)
**GitHub Repo**: [yandifarinango/pe-eval](github-link)
**Graphiti Group**: work:pe-eval

---

### Executive Summary

PE Evaluation is a performance evaluation tool currently in active development.
The project is 60% complete with 2 blocking issues. Recent focus has been on
authentication flows, with API documentation as the next priority.

---

### Task Status

| Status | Count | Percentage |
|--------|-------|------------|
| Done | 12 | 48% |
| In Progress | 5 | 20% |
| Pending | 6 | 24% |
| Blocked | 2 | 8% |
| **Total** | **25** | **100%** |

**Current Sprint**: Sprint 3 (ends Dec 15)
**Sprint Progress**: 3/8 tasks complete

---

### Current Blockers

1. **RS4-125: External API Integration**
   - Waiting on API spec from vendor (3 days)
   - Impact: Blocks 2 downstream tasks
   - Notes: "Emailed vendor on Dec 1, no response"

2. **RS4-130: Database Migration**
   - Requires DevOps approval for production access
   - Impact: Blocks deployment testing

---

### Recent Decisions (from Notes + Memory)

1. **JWT for Authentication** (Nov 28)
   - Chose JWT over sessions for stateless scaling
   - Trade-off: More complex token refresh

2. **PostgreSQL over MongoDB** (Nov 20)
   - Relational data model better fit
   - Existing team expertise

---

### Code Status

**GitHub Activity (Last 7 Days)**:
- Commits: 23
- Open PRs: 2
- Merged PRs: 5

**Open PRs**:
- [#42](link): Auth flow fix - CI Passing, awaiting review
- [#45](link): API docs structure - Draft

**Local State**:
- Uncommitted changes: Yes (3 files modified)
- Current branch: `feature/api-docs`

---

### Knowledge from Memory

Recent facts from Graphiti:

- "User prefers functional React components over class components"
- "API rate limiting set to 100 req/min per user"
- "Deployment target is AWS ECS with Fargate"

---

### Recommendations

1. **Immediate**: Follow up on external API spec (Day 4 of blocking)
2. **This Week**: Merge PR #42 to unblock auth-dependent tasks
3. **Consider**: Break RS4-130 into smaller migration steps
4. **Commit**: Push local changes to avoid work loss

---

### Related Notes

- [PE Eval Architecture](obsidian-link) - Last modified 2 days ago
- [API Rate Limiting Decision](obsidian-link) - Last modified 5 days ago
- [Sprint 3 Planning](obsidian-link) - Last modified 1 week ago
```
